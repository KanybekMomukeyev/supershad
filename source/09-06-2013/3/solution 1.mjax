Обозначим исходный массив через <script type="math/tex">a</script>. Заведем еще четыре массива длины <script type="math/tex">n</script>: <script type="math/tex">b</script>, <script type="math/tex">c</script>, <script type="math/tex">d</script> и <script type="math/tex">e</script>. Пройдем во возрастанию индексов и заполним массив <script type="math/tex">b</script> по правилу <script type="math/tex">b[0] = 2a[0] - 1</script>, <script type="math/tex">b[i] = b[i-1] + 2a[0] - 1</script> при <script type="math/tex">i>1</script>. Иными словами, если в массиве <script type="math/tex">a</script> заменить нули на <script type="math/tex">-1</script>, то в массиве <script type="math/tex">b</script> будут стоять суммы от <script type="math/tex">a[0]</script> до <script type="math/tex">a[i]</script>. Заполним массивы <script type="math/tex">c</script> и <script type="math/tex">d</script> минус единицами. Далее идем по возрастанию номеров по массиву <script type="math/tex">b</script>. Если <script type="math/tex">b[i] = k</script>, то <script type="math/tex">d[k] = i</script>, если при этом выполнено <script type="math/tex">c[k] = -1</script>, то присваеваем <script type="math/tex">c[k]=i</script>.<br>
Далее, когда мы прошли по всему массиву <script type="math/tex">b</script>, заполним массив <script type="math/tex">e</script> по правилу <script type="math/tex">e[i] = d[i] - c[i]</script>. Заметим, что если в массиве <script type="math/tex">a</script> есть подмассив от <script type="math/tex">a[m]</script> до <script type="math/tex">a[l]</script>, в котором равное количество единиц и нулей, то <script type="math/tex">b[m]=b[l]=k</script>. И тогда <script type="math/tex">c[k]</script> &#8212; это минимальный номер <script type="math/tex">i</script> такой, что <script type="math/tex">b[i]=k</script>, а <script type="math/tex">d[k]</script> &#8212; максимальный. Соответственно, <script type="math/tex">e[k]</script> &#8212; максимальное расстояние между <script type="math/tex">m</script> и <script type="math/tex">l</script>, где <script type="math/tex">b[m] = b[l] = k</script>. Найдем максимум массива <script type="math/tex">e</script>, пусть он равен <script type="math/tex">e[j]</script>. Тогда искомый подмассив &#8212; это подмассив от <script type="math/tex">a[c[j]]</script> до <script type="math/tex">a[d[j]]</script>.
